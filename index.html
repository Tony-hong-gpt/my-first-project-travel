<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>여행 리뷰 분석 실험 v2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      vertical-align: top;
    }
    th {
      background-color: #f4f4f4;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>여행 리뷰 AI 실험 v2</h1>

  <p>여러 개의 여행 리뷰를 줄바꿈으로 나눠서 입력해보세요:</p>
  <p style="font-size: 0.9rem; color: #555;">
    예시)<br>
    위치도 좋고 직원들이 정말 친절했어요.<br>
    방은 깨끗했지만 소음이 너무 심했습니다.
  </p>

  <textarea id="reviews"></textarea>
  <br>
  <button onclick="analyzeAll()">모두 분석하기</button>

  <h2>결과:</h2>
  <div id="output"></div>

  <script>
    // 1. 한 리뷰에 대한 점수 계산
    function scoreReview(text) {

      text = text.replace(/\s+/g, " ").trim(); // ★ 문자열 정제

      let score = 50;
      // 긍정 단어
      if (text.includes("좋")) score += 10;
      if (text.includes("추천")) score += 10;
      if (text.includes("만족")) score += 10;
      
      if (text.includes("최고")) score += 5;
      if (text.includes("완벽")) score += 5;
      
      if (text.includes("친절")) score += 10;
      if (text.includes("기쁨")) score += 10;

      // 부정 단어
      if (text.includes("별로") || text.includes("실망") || text.includes("최악")) score -= 20;
      if (text.includes("비쌌") || text.includes("불편") || text.includes("시끄럽") || text.includes("소음")) score -= 10;

      if (score > 100) score = 100;
      if (score < 0) score = 0;
      return score;
    }

    // 2. 키워드 추출
    function extractKeywords(text) {
      const positive = ["좋", "만족", "편안", "친절", "최고", "기분"];
      const negative = ["별로", "불편", "실망", "비쌌", "소음", "시끄럽", "좁", "더럽"];

      const facility = ["방", "룸", "화장실", "침대", "청소", "시설", "욕실"];
      const service = ["직원", "응대", "서비스", "친절"];
      const location = ["위치", "교통", "역", "근처"];
      const price = ["가격", "가성비", "비싸", "저렴"];

      function findMatches(words) {
        return words.filter(w => text.includes(w));
      }

      return {
        positive: findMatches(positive),
        negative: findMatches(negative),
        facility: findMatches(facility),
        service: findMatches(service),
        location: findMatches(location),
        price: findMatches(price)
      };
    }

    // 3. 감정 요약 한 줄 생성
    function summarizeReview(kw, score) {
      let tone = "";

      // 감정 톤 결정
      if (kw.positive.length > 0 && kw.negative.length === 0) {
        tone = "전반적으로 긍정적인 리뷰입니다.";
      } else if (kw.negative.length > 0 && kw.positive.length === 0) {
        tone = "전반적으로 부정적인 리뷰입니다.";
      } else if (kw.positive.length > 0 && kw.negative.length > 0) {
        tone = "좋은 점과 아쉬운 점이 함께 있는 리뷰입니다.";
      } else {
        tone = "감정 표현이 뚜렷하지 않은 리뷰입니다.";
      }

      // 어떤 요소에 대한 내용인지 정리
      const aspects = [];
      if (kw.location.length > 0) aspects.push("위치");
      if (kw.service.length > 0) aspects.push("서비스");
      if (kw.facility.length > 0) aspects.push("시설");
      if (kw.price.length > 0) aspects.push("가격");

      let aspectText = "";
      if (aspects.length > 0) {
        aspectText = aspects.join(", ") + "에 대한 내용입니다.";
      }

      return (tone + " " + aspectText).trim();
    }

    // 4. 키워드 배열을 태그 모양 HTML로 변환
   function renderTags(words, bgColor) {
    if (!words || words.length === 0) {
      return '<span style="font-size:0.8rem; color:#999;">없음</span>';
    }

      return words
        .map(
          w => `<span style="
            display:inline-block;
            padding:4px 8px;
            margin:2px 6px 2px 0;
            border-radius:999px;
            background-color:${bgColor};
            border:1px solid rgba(0,0,0,0.12);
            color:#111;
            font-size:0.8rem;
            font-weight:600;
          ">${w}</span>`
        )
        .join("");
    }


    // 5. 여러 리뷰를 한꺼번에 분석
    function analyzeAll() {
      const raw = document.getElementById("reviews").value.trim();
      const lines = raw
        .split(/\n+/)
        .map(l => l.trim())
        .filter(l => l.length > 0);

      if (lines.length === 0) {
        document.getElementById("output").innerHTML = "<p>리뷰를 입력해주세요.</p>";
        return;
      }

      let totalScore = 0;
      let totalLength = 0;
      let rows = "";

      lines.forEach((review, idx) => {
        const score = scoreReview(review);
        const kw = extractKeywords(review);
        const length = review.length;
        const summary = summarizeReview(kw, score);

        totalScore += score;
        totalLength += length;

        // 점수에 따라 색상 결정
        let scoreColor = "black";
        if (score >= 80) {
          scoreColor = "green";
        } else if (score <= 50) {
          scoreColor = "red";
        }

        rows += `
          <tr>
            <td>${idx + 1}</td>
            <td>${review}</td>
            <td style="color: ${scoreColor}; font-weight: bold;">${score}점</td>
            <td>${length}</td>
            <td>
              <div><strong>긍정:</strong> ${renderTags(kw.positive, "#e6f4ea")}</div>
              <div><strong>부정:</strong> ${renderTags(kw.negative, "#fdecea")}</div>
              <div><strong>시설:</strong> ${renderTags(kw.facility, "#e8f0fe")}</div>
              <div><strong>서비스:</strong> ${renderTags(kw.service, "#fff4e5")}</div>
              <div><strong>위치:</strong> ${renderTags(kw.location, "#e0f7fa")}</div>
              <div><strong>가격:</strong> ${renderTags(kw.price, "#f3e5f5")}</div>
            </td>
            <td>${summary}</td>
          </tr>
        `;
      });

      const avgScore = Math.round(totalScore / lines.length);
      const avgLength = Math.round(totalLength / lines.length);

      document.getElementById("output").innerHTML = `
        <p>
          총 ${lines.length}개의 리뷰, 평균 점수: <strong>${avgScore}점</strong><br>
          평균 리뷰 길이: <strong>${avgLength}글자</strong>
        </p>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>리뷰 내용</th>
              <th>점수</th>
              <th>글자수</th>
              <th>키워드 분석</th>
              <th>요약</th>
            </tr>
          </thead>
          <tbody>
            ${rows}
          </tbody>
        </table>
      `;
    }
  </script>
</body>
</html>
