<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ì—¬í–‰ ë¦¬ë·° ë¶„ì„ ì‹¤í—˜ v2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f8fafc;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      vertical-align: top;
    }
    th {
      background-color: #f4f4f4;
      text-align: left;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }
    
    .card-score {
      font-weight: bold;
      margin-top: 6px;
    }
    
    .card-tags div {
      margin-top: 4px;
    }
    
    .card-summary {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #eee;
      font-size: 0.9rem;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>ì—¬í–‰ ë¦¬ë·° AI ì‹¤í—˜ v2</h1>

  <p>ì—¬ëŸ¬ ê°œì˜ ì—¬í–‰ ë¦¬ë·°ë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë‚˜ëˆ ì„œ ì…ë ¥í•´ë³´ì„¸ìš”:</p>
  <p style="font-size: 0.9rem; color: #555;">
    ì˜ˆì‹œ)<br>
    ìœ„ì¹˜ë„ ì¢‹ê³  ì§ì›ë“¤ì´ ì •ë§ ì¹œì ˆí–ˆì–´ìš”.<br>
    ë°©ì€ ê¹¨ë—í–ˆì§€ë§Œ ì†ŒìŒì´ ë„ˆë¬´ ì‹¬í–ˆìŠµë‹ˆë‹¤.
  </p>

  <textarea id="reviews"></textarea>
  <br>
  <button type="button" onclick="fillSample()">ìƒ˜í”Œ ë¦¬ë·° ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <button onclick="analyzeAll()">ëª¨ë‘ ë¶„ì„í•˜ê¸°</button>

  <h2>ê²°ê³¼:</h2>
  <div id="output"></div>

  <script>
    // 1. í•œ ë¦¬ë·°ì— ëŒ€í•œ ì ìˆ˜ ê³„ì‚°
    function scoreReview(text) {
      // ê³µë°± ì •ë¦¬
      text = text.replace(/\s+/g, " ").trim();
    
      let score = 50;
    
      // âœ… ê¸ì • ë‹¨ì–´: ë‹¨ì–´ í•˜ë‚˜ë§ˆë‹¤ ê°ê° ì ìˆ˜
      if (text.includes("ì¢‹")) score += 10;
      if (text.includes("ì¶”ì²œ")) score += 10;
      if (text.includes("ë§Œì¡±")) score += 10;
    
      if (text.includes("ìµœê³ ")) score += 5;
      if (text.includes("ì™„ë²½")) score += 5;
    
      if (text.includes("ì¹œì ˆ")) score += 10;
      if (text.includes("ê¸°ì¨")) score += 10;
      if (text.includes("ê¸°ë¶„")) score += 10;
    
      // âœ… ë¶€ì • ë‹¨ì–´: í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ê·¸ë§Œí¼ ê¹ê¸°(ì¤‘ë³µ ê°€ëŠ¥í•˜ë©´ ê°œë³„ if ë¡œ)
      if (text.includes("ë³„ë¡œ")) score -= 20;
      if (text.includes("ì‹¤ë§")) score -= 20;
      if (text.includes("ìµœì•…")) score -= 20;
    
      if (text.includes("ë¹„ìŒŒ")) score -= 10;
      if (text.includes("ë¶ˆí¸")) score -= 10;
      if (text.includes("ì‹œë„ëŸ½")) score -= 10;
      if (text.includes("ì†ŒìŒ")) score -= 10;
    
      if (score > 100) score = 100;
      if (score < 0) score = 0;
      return score;
    }

    // 2. í‚¤ì›Œë“œ ì¶”ì¶œ
    function extractKeywords(text) {
      const positive = ["ì¢‹", "ë§Œì¡±", "í¸ì•ˆ", "ì¹œì ˆ", "ìµœê³ ", "ê¸°ë¶„"];
      const negative = ["ë³„ë¡œ", "ë¶ˆí¸", "ì‹¤ë§", "ë¹„ìŒŒ", "ì†ŒìŒ", "ì‹œë„ëŸ½", "ì¢", "ë”ëŸ½"];

      const facility = ["ë°©", "ë£¸", "í™”ì¥ì‹¤", "ì¹¨ëŒ€", "ì²­ì†Œ", "ì‹œì„¤", "ìš•ì‹¤"];
      const service = ["ì§ì›", "ì‘ëŒ€", "ì„œë¹„ìŠ¤", "ì¹œì ˆ"];
      const location = ["ìœ„ì¹˜", "êµí†µ", "ì—­", "ê·¼ì²˜"];
      const price = ["ê°€ê²©", "ê°€ì„±ë¹„", "ë¹„ì‹¸", "ì €ë ´"];

      function findMatches(words) {
        return words.filter(w => text.includes(w));
      }

      return {
        positive: findMatches(positive),
        negative: findMatches(negative),
        facility: findMatches(facility),
        service: findMatches(service),
        location: findMatches(location),
        price: findMatches(price)
      };
    }

    // 3. ê°ì • ìš”ì•½ í•œ ì¤„ ìƒì„±
    function summarizeReview(kw, score) {
      let tone = "";

      // ê°ì • í†¤ ê²°ì •
      if (kw.positive.length > 0 && kw.negative.length === 0) {
        tone = "ì „ë°˜ì ìœ¼ë¡œ ê¸ì •ì ì¸ ë¦¬ë·°ì…ë‹ˆë‹¤.";
      } else if (kw.negative.length > 0 && kw.positive.length === 0) {
        tone = "ì „ë°˜ì ìœ¼ë¡œ ë¶€ì •ì ì¸ ë¦¬ë·°ì…ë‹ˆë‹¤.";
      } else if (kw.positive.length > 0 && kw.negative.length > 0) {
        tone = "ì¢‹ì€ ì ê³¼ ì•„ì‰¬ìš´ ì ì´ í•¨ê»˜ ìˆëŠ” ë¦¬ë·°ì…ë‹ˆë‹¤.";
      } else {
        tone = "ê°ì • í‘œí˜„ì´ ëšœë ·í•˜ì§€ ì•Šì€ ë¦¬ë·°ì…ë‹ˆë‹¤.";
      }

      // ì–´ë–¤ ìš”ì†Œì— ëŒ€í•œ ë‚´ìš©ì¸ì§€ ì •ë¦¬
      const aspects = [];
      if (kw.location.length > 0) aspects.push("ìœ„ì¹˜");
      if (kw.service.length > 0) aspects.push("ì„œë¹„ìŠ¤");
      if (kw.facility.length > 0) aspects.push("ì‹œì„¤");
      if (kw.price.length > 0) aspects.push("ê°€ê²©");

      let aspectText = "";
      if (aspects.length > 0) {
        aspectText = aspects.join(", ") + "ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.";
      }

      return (tone + " " + aspectText).trim();
    }

    // 4. í‚¤ì›Œë“œ ë°°ì—´ì„ íƒœê·¸ ëª¨ì–‘ HTMLë¡œ ë³€í™˜
   function renderTags(words, bgColor) {
    if (!words || words.length === 0) {
      return '<span style="font-size:0.8rem; color:#999;">ì—†ìŒ</span>';
    }

      return words
        .map(
          w => `<span style="
            display:inline-block;
            padding:4px 8px;
            margin:2px 6px 2px 0;
            border-radius:999px;
            background-color:${bgColor};
            border:1px solid rgba(0,0,0,0.12);
            color:#111;
            font-size:0.8rem;
            font-weight:600;
          ">${w}</span>`
        )
        .join("");
    }

    // â¬‡â¬‡â¬‡ ì—¬ê¸°ë¶€í„° ìƒˆë¡œ ì¶”ê°€ â¬‡â¬‡â¬‡
    function fillSample() {
      const sampleLines = [
        "ìœ„ì¹˜ë„ ì¢‹ê³  ì§ì›ë“¤ì´ ì •ë§ ì¹œì ˆí•´ì„œ ë‹¤ì‹œ ì˜¤ê³  ì‹¶ì€ ê³³ì…ë‹ˆë‹¤. ì •ë§ ë§Œì¡±í•©ë‹ˆë‹¤.",
        "ë°©ì€ ê¹¨ë—í–ˆì§€ë§Œ ì†ŒìŒì´ ì¡°ê¸ˆ ì•„ì‰¬ì› ì–´ìš”.",
        "ê°€ê²©ì€ ì¡°ê¸ˆ ë¹„ìŒŒì§€ë§Œ ì„œë¹„ìŠ¤ì™€ ìœ„ì¹˜ëŠ” ë§¤ìš° ë§Œì¡±ìŠ¤ëŸ¬ì› ìŠµë‹ˆë‹¤.",
        "ì£¼ë³€ ê´€ê´‘ì§€ê°€ ë§ì•„ì„œ ì´ë™í•˜ê¸° í¸í–ˆìŠµë‹ˆë‹¤.",
        "ì§ì› ì‘ëŒ€ê°€ ì¹œì ˆí–ˆê³  ì²´í¬ì¸ ê³¼ì •ë„ í¸ì•ˆí–ˆìŠµë‹ˆë‹¤."
      ];

      const sampleText = sampleLines.join("\n");
      document.getElementById("reviews").value = sampleText;
    }
    // â¬†â¬†â¬† ì—¬ê¸°ê¹Œì§€ ìƒˆë¡œ ì¶”ê°€ â¬†â¬†â¬†

    // 5. ì—¬ëŸ¬ ë¦¬ë·°ë¥¼ í•œêº¼ë²ˆì— ë¶„ì„
    function analyzeAll() {
      const raw = document.getElementById("reviews").value.trim();
      const lines = raw
        .split(/\n+/)
        .map(l => l.trim())
        .filter(l => l.length > 0);

      if (lines.length === 0) {
        document.getElementById("output").innerHTML = "<p>ë¦¬ë·°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>";
        return;
      }

      let totalScore = 0;
      let totalLength = 0;
      let rows = "";

      lines.forEach((review, idx) => {
        const score = scoreReview(review);
        const kw = extractKeywords(review);
        const length = review.length;
        const summary = summarizeReview(kw, score);

        totalScore += score;
        totalLength += length;

      // ì ìˆ˜ì— ë”°ë¼ ìƒ‰ìƒ ê²°ì • (ê¸€ì ìƒ‰)
      let scoreColor = "black";
      if (score >= 80) {
        scoreColor = "green";
      } else if (score <= 50) {
        scoreColor = "red";
      }

      function scoreEmoji(score) {
      if (score >= 80) return "ğŸ˜Š";
      if (score >= 60) return "ğŸ™‚";
      if (score >= 40) return "ğŸ˜";
      return "ğŸ˜¢";
      }

      // â­ ì ìˆ˜ì— ë”°ë¼ ì¹´ë“œ ë°°ê²½ìƒ‰ë„ ê²°ì •
      let cardBg = "#ffffff"; // ê¸°ë³¸ í°ìƒ‰
      if (score >= 80) {
        cardBg = "#ecfdf3";   // ì—°í•œ ì´ˆë¡ (ì•„ì£¼ ì¢‹ì€ ë¦¬ë·°)
      } else if (score <= 50) {
        cardBg = "#fef2f2";   // ì—°í•œ ë¹¨ê°• (ë³„ë¡œì¸ ë¦¬ë·°)
      }

      rows += `
        <div class="card" style="background-color:${cardBg};">
          <div class="card-content">
            <div><strong>ë¦¬ë·° ë‚´ìš©:</strong> ${review}</div>
      
            <div class="card-score" style="color:${scoreColor};">
            ì ìˆ˜: ${score}ì  ${scoreEmoji(score)}
            </div>
      
            <div>ê¸€ììˆ˜: ${length}ì</div>
      
            <div class="card-tags">
              <div><strong>ê¸ì •:</strong> ${renderTags(kw.positive, "#e6f4ea")}</div>
              <div><strong>ë¶€ì •:</strong> ${renderTags(kw.negative, "#fdecea")}</div>
              <div><strong>ì‹œì„¤:</strong> ${renderTags(kw.facility, "#e8f0fe")}</div>
              <div><strong>ì„œë¹„ìŠ¤:</strong> ${renderTags(kw.service, "#fff4e5")}</div>
              <div><strong>ìœ„ì¹˜:</strong> ${renderTags(kw.location, "#e0f7fa")}</div>
              <div><strong>ê°€ê²©:</strong> ${renderTags(kw.price, "#f3e5f5")}</div>
            </div>
      
            <div class="card-summary">${summary}</div>
          </div>
        </div>
      `;

      });

      const avgScore = Math.round(totalScore / lines.length);
      const avgLength = Math.round(totalLength / lines.length);

      document.getElementById("output").innerHTML = `
      <p>
        ì´ ${lines.length}ê°œì˜ ë¦¬ë·°, í‰ê·  ì ìˆ˜: <strong>${avgScore}ì </strong><br>
        í‰ê·  ë¦¬ë·° ê¸¸ì´: <strong>${avgLength}ê¸€ì</strong>
      </p>
      ${rows}
    `;

    }
  </script>
</body>
</html>
