<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ì—¬í–‰ ë¦¬ë·° ë¶„ì„ ì‹¤í—˜ v2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      vertical-align: top;
    }
    th {
      background-color: #f4f4f4;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>ì—¬í–‰ ë¦¬ë·° AI ì‹¤í—˜ v2</h1>

  <p>ì—¬ëŸ¬ ê°œì˜ ì—¬í–‰ ë¦¬ë·°ë¥¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë‚˜ëˆ ì„œ ì…ë ¥í•´ë³´ì„¸ìš”:</p>
  <p style="font-size: 0.9rem; color: #555;">
    ì˜ˆì‹œ)<br>
    ìœ„ì¹˜ë„ ì¢‹ê³  ì§ì›ë“¤ì´ ì •ë§ ì¹œì ˆí–ˆì–´ìš”.<br>
    ë°©ì€ ê¹¨ë—í–ˆì§€ë§Œ ì†ŒìŒì´ ë„ˆë¬´ ì‹¬í–ˆìŠµë‹ˆë‹¤.
  </p>

  <textarea id="reviews"></textarea>
  <br>
  <button onclick="analyzeAll()">ëª¨ë‘ ë¶„ì„í•˜ê¸°</button>

  <h2>ê²°ê³¼:</h2>
  <div id="output"></div>

  <script>
    // í•œ ë¦¬ë·°ì— ëŒ€í•œ ì ìˆ˜ ê³„ì‚°
    function scoreReview(text) {
      let score = 50; // ê¸°ë³¸ ì ìˆ˜

      // ê¸ì • ë‹¨ì–´
      if (text.includes("ì¢‹") || text.includes("ì¶”ì²œ") || text.includes("ë§Œì¡±")) score += 20;
      if (text.includes("ìµœê³ ") || text.includes("ì™„ë²½")) score += 20;
      if (text.includes("ì¹œì ˆ") || text.includes("ë§›ìˆ")| text.includes("ê°€ê¹")) score += 10;

      // ë¶€ì • ë‹¨ì–´
      if (text.includes("ë³„ë¡œ") || text.includes("ì‹¤ë§") || text.includes("ìµœì•…")) score -= 20;
      if (text.includes("ë¹„ìŒŒ") || text.includes("ë¶ˆí¸") || text.includes("ì‹œë„ëŸ½") || text.includes("ì†ŒìŒ")) score -= 10;

      if (score > 100) score = 100;
      if (score < 0) score = 0;
      return score;
    }

    // í‚¤ì›Œë“œ ì¶”ì¶œ
    function extractKeywords(text) {
      const positive = ["ì¢‹", "ë§Œì¡±", "í¸ì•ˆ", "ì¹œì ˆ", "ìµœê³ ", "ê¸°ë¶„"];
      const negative = ["ë³„ë¡œ", "ë¶ˆí¸", "ì‹¤ë§", "ë¹„ìŒŒ", "ì†ŒìŒ", "ì‹œë„ëŸ½", "ì¢", "ë”ëŸ½"];

      const facility = ["ë°©", "ë£¸", "í™”ì¥ì‹¤", "ì¹¨ëŒ€", "ì²­ì†Œ", "ì‹œì„¤", "ìš•ì‹¤"];
      const service = ["ì§ì›", "ì‘ëŒ€", "ì„œë¹„ìŠ¤", "ì¹œì ˆ"];
      const location = ["ìœ„ì¹˜", "êµí†µ", "ì—­", "ê·¼ì²˜"];
      const price = ["ê°€ê²©", "ê°€ì„±ë¹„", "ë¹„ì‹¸", "ì €ë ´"];

      function findMatches(words) {
        return words.filter(w => text.includes(w));
      }

      return {
        positive: findMatches(positive),
        negative: findMatches(negative),
        facility: findMatches(facility),
        service: findMatches(service),
        location: findMatches(location),
        price: findMatches(price)
      };
    }

    // ğŸ”½ğŸ”½ğŸ”½ ì—¬ê¸°ë¶€í„° ìƒˆë¡œ ì¶”ê°€ ğŸ”½ğŸ”½ğŸ”½
function summarizeReview(kw, score) {
  let tone = "";

  // ê°ì • í†¤ ê²°ì •
  if (kw.positive.length > 0 && kw.negative.length === 0) {
    tone = "ì „ë°˜ì ìœ¼ë¡œ ê¸ì •ì ì¸ ë¦¬ë·°ì…ë‹ˆë‹¤.";
  } else if (kw.negative.length > 0 && kw.positive.length === 0) {
    tone = "ì „ë°˜ì ìœ¼ë¡œ ë¶€ì •ì ì¸ ë¦¬ë·°ì…ë‹ˆë‹¤.";
  } else if (kw.positive.length > 0 && kw.negative.length > 0) {
    tone = "ì¢‹ì€ ì ê³¼ ì•„ì‰¬ìš´ ì ì´ í•¨ê»˜ ìˆëŠ” ë¦¬ë·°ì…ë‹ˆë‹¤.";
  } else {
    tone = "ê°ì • í‘œí˜„ì´ ëšœë ·í•˜ì§€ ì•Šì€ ë¦¬ë·°ì…ë‹ˆë‹¤.";
  }

  // ì–´ë–¤ ìš”ì†Œì— ëŒ€í•œ ë‚´ìš©ì¸ì§€ ì •ë¦¬
  const aspects = [];
  if (kw.location.length > 0) aspects.push("ìœ„ì¹˜");
  if (kw.service.length > 0) aspects.push("ì„œë¹„ìŠ¤");
  if (kw.facility.length > 0) aspects.push("ì‹œì„¤");
  if (kw.price.length > 0) aspects.push("ê°€ê²©");

  let aspectText = "";
  if (aspects.length > 0) {
    aspectText = aspects.join(", ") + "ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.";
  }

  // ë‘ ë¬¸ì¥ì„ í•˜ë‚˜ë¡œ í•©ì³ ë°˜í™˜
  return (tone + " " + aspectText).trim();
}
    // ğŸ”¼ğŸ”¼ğŸ”¼ ì—¬ê¸°ê¹Œì§€ ìƒˆë¡œ ì¶”ê°€ ğŸ”¼ğŸ”¼ğŸ”¼
    
    // ì—¬ëŸ¬ ë¦¬ë·°ë¥¼ í•œêº¼ë²ˆì— ë¶„ì„
    function analyzeAll() {
      const raw = document.getElementById("reviews").value.trim();
      const lines = raw
        .split(/\n+/)
        .map(l => l.trim())
        .filter(l => l.length > 0);

      if (lines.length === 0) {
        document.getElementById("output").innerHTML = "<p>ë¦¬ë·°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>";
        return;
      }

      let totalScore = 0;
      let totalLength = 0;
      let rows = "";

      lines.forEach((review, idx) => {
        const score = scoreReview(review);
        const kw = extractKeywords(review);
        const length = review.length;
        const summary = summarizeReview(kw, score);   // â† â˜… ìƒˆë¡œ ì¶”ê°€

        totalScore += score;
        totalLength += length;

        // ì ìˆ˜ì— ë”°ë¼ ìƒ‰ìƒ ê²°ì •
        let scoreColor = "black";
        if (score >= 80) {
          scoreColor = "green";
        } else if (score <= 50) {
          scoreColor = "red";
        }

        rows += `
          <tr>
            <td>${idx + 1}</td>
            <td>${review}</td>
            <td style="color: ${scoreColor}; font-weight: bold;">${score}ì </td>
            <td>${length}</td>
            <td>
              <strong>ê¸ì •:</strong> ${kw.positive.join(", ") || "ì—†ìŒ"}<br>
              <strong>ë¶€ì •:</strong> ${kw.negative.join(", ") || "ì—†ìŒ"}<br>
              <strong>ì‹œì„¤:</strong> ${kw.facility.join(", ") || "ì—†ìŒ"}<br>
              <strong>ì„œë¹„ìŠ¤:</strong> ${kw.service.join(", ") || "ì—†ìŒ"}<br>
              <strong>ìœ„ì¹˜:</strong> ${kw.location.join(", ") || "ì—†ìŒ"}<br>
              <strong>ê°€ê²©:</strong> ${kw.price.join(", ") || "ì—†ìŒ"}
            </td>
            <td>${summary}</td>
          </tr>
        `;
      });

      const avgScore = Math.round(totalScore / lines.length);
      const avgLength = Math.round(totalLength / lines.length);

      document.getElementById("output").innerHTML = `
        <p>
          ì´ ${lines.length}ê°œì˜ ë¦¬ë·°, í‰ê·  ì ìˆ˜: <strong>${avgScore}ì </strong><br>
          í‰ê·  ë¦¬ë·° ê¸¸ì´: <strong>${avgLength}ê¸€ì</strong>
        </p>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>ë¦¬ë·° ë‚´ìš©</th>
              <th>ì ìˆ˜</th>
              <th>ê¸€ììˆ˜</th>
              <th>í‚¤ì›Œë“œ ë¶„ì„</th>
              <th>ìš”ì•½</th>
            </tr>
          </thead>
          <tbody>
            ${rows}
          </tbody>
        </table>
      `;
    }
  </script>
</body>
</html>
